"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[945],{350:(e,t,r)=>{r.d(t,{ZJ:()=>u.A,WG:()=>f,y1:()=>s,lY:()=>d,$p:()=>c});var o=r(425),a=r(9509);let n={setToken:e=>{try{localStorage.setItem("token",e),console.log("Token stored successfully in localStorage"),sessionStorage.setItem("token",e),console.log("Token also stored in sessionStorage as backup")}catch(t){console.error("Failed to store token:",t);try{sessionStorage.setItem("token",e),console.log("Token stored in sessionStorage as fallback")}catch(e){console.error("Failed to store token in sessionStorage:",e)}}},getToken:()=>{try{let e=localStorage.getItem("token");if(e)return console.log("Token retrieved from localStorage"),e;if(e=sessionStorage.getItem("token")){console.log("Token retrieved from sessionStorage (fallback)");try{localStorage.setItem("token",e)}catch(e){console.log("Could not restore token to localStorage")}return e}return console.log("No token found in any storage"),null}catch(e){return console.error("Error retrieving token:",e),null}},removeToken:()=>{try{localStorage.removeItem("token"),console.log("Token removed from localStorage")}catch(e){console.error("Error removing token from localStorage:",e)}try{sessionStorage.removeItem("token"),console.log("Token removed from sessionStorage")}catch(e){console.error("Error removing token from sessionStorage:",e)}}},s={register:async e=>{console.log("=== REGISTER ATTEMPT ==="),console.log("User data:",{username:e.username,email:e.email,name:e.name,password:"***"}),console.log("API URL:",a.env.NEXT_PUBLIC_API_URL||"https://my-manager-api-8xme.onrender.com/api");try{let t=await o.A.post("/users/register",e);if(console.log("Register response received:",t.status,t.data),t.data.token)n.setToken(t.data.token),console.log("Token saved after registration:",t.data.token.substring(0,15)+"...");else throw console.error("No token received in register response"),Error("No authentication token received");return t.data}catch(e){var t,r,s,i,c,l,d,u,g,f,m,v;if(console.error("Register error details:",{message:e.message,status:null===(t=e.response)||void 0===t?void 0:t.status,data:null===(r=e.response)||void 0===r?void 0:r.data,config:{url:null===(s=e.config)||void 0===s?void 0:s.url,method:null===(i=e.config)||void 0===i?void 0:i.method,headers:null===(c=e.config)||void 0===c?void 0:c.headers}}),(null===(l=e.response)||void 0===l?void 0:l.status)===400)throw Error((null===(f=e.response)||void 0===f?void 0:null===(g=f.data)||void 0===g?void 0:g.message)||"Invalid registration data");if((null===(d=e.response)||void 0===d?void 0:d.status)===409)throw Error("Username or email already exists");if((null===(u=e.response)||void 0===u?void 0:u.status)===500)throw Error("Server error. Please try again later.");else if(e.response)throw Error((null===(v=e.response)||void 0===v?void 0:null===(m=v.data)||void 0===m?void 0:m.message)||"Registration failed");else throw Error("Network error. Please check your connection.")}},login:async e=>{console.log("=== LOGIN ATTEMPT ==="),console.log("Credentials:",{username:e.username,password:"***"}),console.log("API URL:",a.env.NEXT_PUBLIC_API_URL||"https://my-manager-api-8xme.onrender.com/api");try{let t=await o.A.post("/users/login",e);if(console.log("Login response received:",t.status,t.data),t.data.token)n.setToken(t.data.token),console.log("Token saved after login:",t.data.token.substring(0,15)+"...");else throw console.error("No token received in login response"),Error("No authentication token received");return t.data}catch(e){var t,r,s,i,c,l,d,u,g,f;if(console.error("Login error details:",{message:e.message,status:null===(t=e.response)||void 0===t?void 0:t.status,data:null===(r=e.response)||void 0===r?void 0:r.data,config:{url:null===(s=e.config)||void 0===s?void 0:s.url,method:null===(i=e.config)||void 0===i?void 0:i.method,headers:null===(c=e.config)||void 0===c?void 0:c.headers}}),(null===(l=e.response)||void 0===l?void 0:l.status)===401)throw Error("Invalid username or password");if((null===(d=e.response)||void 0===d?void 0:d.status)===404)throw Error("User not found");if((null===(u=e.response)||void 0===u?void 0:u.status)===500)throw Error("Server error. Please try again later.");else if(e.response)throw Error((null===(f=e.response)||void 0===f?void 0:null===(g=f.data)||void 0===g?void 0:g.message)||"Login failed");else throw Error("Network error. Please check your connection.")}},logout:()=>{console.log("Logout called - removing token from all storage"),n.removeToken()},getProfile:async()=>{console.log("Getting profile - checking token...");let e=n.getToken();console.log("Current token:",e?e.substring(0,15)+"...":"No token found");try{let e=await o.A.get("/users/profile");return console.log("Profile fetch successful"),e.data}catch(e){var t,r;throw console.error("Profile fetch failed:",null==e?void 0:null===(t=e.response)||void 0===t?void 0:t.status,null==e?void 0:null===(r=e.response)||void 0===r?void 0:r.data),e}},updateProfile:async e=>(await o.A.put("/users/profile",e)).data,isAuthenticated:()=>{let e=n.getToken(),t=!!e;return console.log("isAuthenticated check:",{hasToken:!!e,tokenPreview:e?e.substring(0,15)+"...":"None",result:t}),t}},i=e=>/^[0-9a-fA-F]{24}$/.test(e),c={getAllProjects:async()=>(await o.A.get("/projects")).data,getProjectById:async e=>{if(!e||"string"!=typeof e)throw Error("Invalid project ID: ID is missing or not a string");if(!i(e))throw Error("Invalid project ID format: must be a valid MongoDB ObjectId");try{return(await o.A.get("/projects/".concat(e))).data}catch(e){throw console.error("Error fetching project:",e),e}},createProject:async e=>(await o.A.post("/projects",e)).data,updateProject:async(e,t)=>{if(!e||!i(e))throw Error("Invalid project ID");return(await o.A.put("/projects/".concat(e),t)).data},deleteProject:async e=>{if(!e||!i(e))throw Error("Invalid project ID");return(await o.A.delete("/projects/".concat(e))).data}},l={getNotifications:async()=>{try{let e=await o.A.get("/notifications");return Array.isArray(e.data)?e.data:[]}catch(t){var e;if((null==t?void 0:null===(e=t.response)||void 0===e?void 0:e.status)===401)return console.log("User not authenticated for notifications"),[];return console.error("Failed to fetch notifications:",t),[]}},markAsRead:async e=>{try{return(await o.A.put("/notifications/".concat(e,"/read"))).data}catch(e){var t;if((null==e?void 0:null===(t=e.response)||void 0===t?void 0:t.status)===401)return console.log("User not authenticated for marking notification as read"),null;return console.error("Failed to mark notification as read:",e),null}},markAllAsRead:async()=>{try{return(await o.A.put("/notifications/read-all")).data}catch(t){var e;if((null==t?void 0:null===(e=t.response)||void 0===e?void 0:e.status)===401)return console.log("User not authenticated for marking all notifications as read"),null;return console.error("Failed to mark all notifications as read:",t),null}},deleteNotification:async e=>{try{return(await o.A.delete("/notifications/".concat(e))).data}catch(e){var t;if((null==e?void 0:null===(t=e.response)||void 0===t?void 0:t.status)===401)return console.log("User not authenticated for deleting notification"),null;return console.error("Failed to delete notification:",e),null}},getUnreadCount:async()=>{try{let e=await l.getNotifications();if(!Array.isArray(e))return console.warn("Notifications is not an array:",e),0;return e.filter(e=>!e.isRead).length}catch(e){return console.error("Failed to get unread count:",e),0}}},d=l;var u=r(2665);class g{async getApartmentsByProject(e){return(await o.A.get("/apartments/project/".concat(e))).data}async createApartment(e,t){return(await o.A.post("/apartments/project/".concat(e),t)).data}async updateApartment(e,t){return(await o.A.put("/apartments/".concat(e),t)).data}async deleteApartment(e){await o.A.delete("/apartments/".concat(e))}async getApartmentById(e){return(await o.A.get("/apartments/".concat(e))).data}}let f=new g;r(1399),r(9799),r(4938)},425:(e,t,r)=>{r.d(t,{A:()=>i});var o=r(3464);let a=r(9509).env.NEXT_PUBLIC_API_URL||"https://my-manager-api-8xme.onrender.com/api",n=()=>{try{let e=localStorage.getItem("token");if(e)return e;if(e=sessionStorage.getItem("token")){try{localStorage.setItem("token",e)}catch(e){}return e}return null}catch(e){return console.error("Error retrieving auth token:",e),null}},s=o.A.create({baseURL:a,headers:{"Content-Type":"application/json"},timeout:15e3,maxRedirects:3,maxContentLength:0x3200000,maxBodyLength:0xa00000,validateStatus:e=>e>=200&&e<300});s.interceptors.request.use(e=>{var t;let r=n();return console.log("=== API REQUEST DEBUG ==="),console.log("Full URL:",(e.baseURL||"")+(e.url||"")),console.log("Method:",null===(t=e.method)||void 0===t?void 0:t.toUpperCase()),console.log("Headers:",e.headers),console.log("Data:",e.data),console.log("Auth token present:",!!r),r?e.headers.Authorization="Bearer ".concat(r):console.log("No auth token available for request to:",e.url),e.metadata={startTime:Date.now()},e},e=>Promise.reject(e)),s.interceptors.response.use(e=>{var t,r;let o=Date.now()-((null===(t=e.config.metadata)||void 0===t?void 0:t.startTime)||0);return console.log("=== API RESPONSE DEBUG ==="),console.log("Status:",e.status),console.log("URL:",e.config.url),console.log("Data:",e.data),console.log("Duration:",o+"ms"),o>2e3&&console.warn("Slow API request: ".concat(null===(r=e.config.method)||void 0===r?void 0:r.toUpperCase()," ").concat(e.config.url," took ").concat(o,"ms")),e},e=>{var t,r,o,a,n;let s=Date.now()-((null===(r=e.config)||void 0===r?void 0:null===(t=r.metadata)||void 0===t?void 0:t.startTime)||0);if("ECONNABORTED"===e.code)console.error("Request timeout after ".concat(s,"ms. Server might be starting up if using Render free tier.")),alert(s>1e4?"Server is taking longer than usual to respond. Please wait and try again.":"Request timed out. Please check your connection and try again.");else if(e.response){if(e.response){if(401===e.response.status){console.error("Authentication error:",e.response.data);try{localStorage.removeItem("token"),sessionStorage.removeItem("token"),console.log("Cleared invalid tokens from both storages")}catch(e){console.error("Error clearing tokens:",e)}}else 403===e.response.status?(console.error("Authorization error:",e.response.data),console.log("Current user lacks permission for this resource")):502===e.response.status||503===e.response.status?(console.error("Server unavailable. May be starting up if on free tier."),alert("Server is currently unavailable. If using Render free tier, it may take 30-60 seconds to start up. Please try again shortly.")):e.response.status>=500&&(console.error("Server error:",e.response.status,e.response.data),alert("Server error occurred. Please try again later."));s>2e3&&console.warn("Slow failed API request: ".concat(null===(a=e.config)||void 0===a?void 0:null===(o=a.method)||void 0===o?void 0:o.toUpperCase()," ").concat(null===(n=e.config)||void 0===n?void 0:n.url," took ").concat(s,"ms"))}}else console.error("Network error:",e.message),alert("Network error: Unable to connect to the server. Please check your internet connection.");return Promise.reject(e)});let i=s},1399:(e,t,r)=>{r.d(t,{L:()=>a});var o=r(425);let a={async getProgressEntries(e){try{return(await o.A.get("/progress/apartment/".concat(e))).data}catch(e){throw console.error("Error fetching progress entries:",e),e}},async createProgressEntry(e,t){try{return(await o.A.post("/progress/apartment/".concat(e),t,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(e){throw console.error("Error creating progress entry:",e),e}},async updateProgressEntry(e,t){try{return(await o.A.put("/progress/".concat(e),t)).data}catch(e){throw console.error("Error updating progress entry:",e),e}},async deleteProgressEntry(e){try{await o.A.delete("/progress/".concat(e))}catch(e){throw console.error("Error deleting progress entry:",e),e}},async getProgressEntry(e){try{return(await o.A.get("/progress/".concat(e))).data}catch(e){throw console.error("Error fetching progress entry:",e),e}}}},2665:(e,t,r)=>{r.d(t,{A:()=>a});var o=r(425);let a={getAllUsers:async()=>(await o.A.get("/users/admin/users")).data,deleteUser:async e=>(await o.A.delete("/users/admin/users/".concat(e))).data,isAdmin:async()=>{try{return(await o.A.get("/users/check-admin")).data.isAdmin}catch(e){return console.error("Admin check error:",e),!1}},getProjectSubscriptions:async()=>(await o.A.get("/subscriptions")).data,subscribeToProject:async e=>(await o.A.post("/subscriptions/".concat(e,"/subscribe"))).data,unsubscribeFromProject:async e=>(await o.A.post("/subscriptions/".concat(e,"/unsubscribe"))).data,toggleProjectSubscription:async e=>(await o.A.post("/subscriptions/".concat(e,"/toggle"))).data}},3999:(e,t,r)=>{r.d(t,{cn:()=>n});var o=r(2596),a=r(9688);function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.QP)((0,o.$)(t))}},4658:(e,t,r)=>{r.d(t,{E:()=>n});var o=r(2115),a=r(350);let n=()=>{let[e,t]=(0,o.useState)(0),[r,n]=(0,o.useState)(!1),s=(0,o.useCallback)(async()=>{try{n(!0);let e=await a.lY.getUnreadCount();t(e)}catch(e){console.error("Failed to fetch unread notifications count:",e),t(0)}finally{n(!1)}},[]),i=(0,o.useCallback)(async e=>{try{if(await a.lY.markAsRead(e))return t(e=>Math.max(0,e-1)),!0;return!1}catch(e){return console.error("Error marking notification as read:",e),!1}},[]),c=(0,o.useCallback)(async()=>{try{if(await a.lY.markAllAsRead())return t(0),!0;return!1}catch(e){return console.error("Error marking all notifications as read:",e),!1}},[]);return(0,o.useEffect)(()=>{s();let e=setInterval(()=>{s()},6e4);return()=>clearInterval(e)},[s]),{unreadCount:e,isLoading:r,fetchUnreadCount:s,markAsRead:i,markAllAsRead:c}}},4938:(e,t,r)=>{r.d(t,{C:()=>a});var o=r(425);let a={async getFieldInstructions(e){try{return(await o.A.get("/field-instructions/apartment/".concat(e))).data}catch(e){throw console.error("Error fetching field instructions:",e),e}},async createFieldInstruction(e,t){try{return(await o.A.post("/field-instructions/apartment/".concat(e),t,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(e){throw console.error("Error creating field instruction:",e),e}},async updateFieldInstruction(e,t){try{return(await o.A.put("/field-instructions/".concat(e),t)).data}catch(e){throw console.error("Error updating field instruction:",e),e}},async deleteFieldInstruction(e){try{await o.A.delete("/field-instructions/".concat(e))}catch(e){throw console.error("Error deleting field instruction:",e),e}},async getFieldInstruction(e){try{return(await o.A.get("/field-instructions/".concat(e))).data}catch(e){throw console.error("Error fetching field instruction:",e),e}},async updateInstructionStatus(e,t){try{return(await o.A.patch("/field-instructions/".concat(e,"/status"),{status:t})).data}catch(e){throw console.error("Error updating instruction status:",e),e}}}},6064:(e,t,r)=>{r.d(t,{A:()=>v});var o=r(5155),a=r(5695),n=r(6874),s=r.n(n),i=r(7340),c=r(3504),l=r(3861),d=r(1007),u=r(2115),g=r(350),f=r(8145),m=r(4658);function v(){let e=(0,a.usePathname)(),[t,r]=(0,u.useState)(!1),{unreadCount:n}=(0,m.E)();(0,u.useEffect)(()=>{r(g.y1.isAuthenticated())},[]);let v=t=>!!("/"===t&&"/"===e||"/"!==t&&e.startsWith(t));return(0,o.jsx)("div",{className:"fixed bottom-0 left-0 right-0 border-t bg-background",children:(0,o.jsxs)("div",{className:"flex justify-around items-center h-16",children:[(0,o.jsx)(s(),{href:"/",className:"flex flex-col items-center justify-center w-full",children:(0,o.jsxs)("div",{className:"flex flex-col items-center justify-center ".concat(v("/")?"text-primary":"text-muted-foreground"),children:[(0,o.jsx)(i.A,{className:"h-5 w-5"}),(0,o.jsx)("span",{className:"text-xs mt-1",children:"Home"})]})}),(0,o.jsx)(s(),{href:"/projects",className:"flex flex-col items-center justify-center w-full",children:(0,o.jsxs)("div",{className:"flex flex-col items-center justify-center ".concat(v("/projects")?"text-primary":"text-muted-foreground"),children:[(0,o.jsx)(c.A,{className:"h-5 w-5"}),(0,o.jsx)("span",{className:"text-xs mt-1",children:"Projects"})]})}),(0,o.jsx)(s(),{href:"/alerts",className:"flex flex-col items-center justify-center w-full",children:(0,o.jsxs)("div",{className:"flex flex-col items-center justify-center ".concat(v("/alerts")?"text-primary":"text-muted-foreground"),children:[(0,o.jsxs)("div",{className:"relative",children:[(0,o.jsx)(l.A,{className:"h-5 w-5"}),n>0&&(0,o.jsx)(f.E,{variant:"destructive",className:"absolute -top-2 -right-2 h-4 w-4 p-0 flex items-center justify-center text-[10px] rounded-full",children:n>9?"9+":n})]}),(0,o.jsx)("span",{className:"text-xs mt-1",children:"Alerts"})]})}),(0,o.jsx)(s(),{href:"/profile",className:"flex flex-col items-center justify-center w-full",children:(0,o.jsxs)("div",{className:"flex flex-col items-center justify-center ".concat(v("/profile")?"text-primary":"text-muted-foreground"),children:[(0,o.jsx)(d.A,{className:"h-5 w-5"}),(0,o.jsx)("span",{className:"text-xs mt-1",children:"Profile"})]})})]})})}},7168:(e,t,r)=>{r.d(t,{$:()=>l,r:()=>c});var o=r(5155),a=r(2115),n=r(9708),s=r(2085),i=r(3999);let c=(0,s.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),l=a.forwardRef((e,t)=>{let{className:r,variant:a,size:s,asChild:l=!1,...d}=e,u=l?n.DX:"button";return(0,o.jsx)(u,{className:(0,i.cn)(c({variant:a,size:s,className:r})),ref:t,...d})});l.displayName="Button"},8145:(e,t,r)=>{r.d(t,{E:()=>i});var o=r(5155);r(2115);var a=r(2085),n=r(3999);let s=(0,a.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:r,...a}=e;return(0,o.jsx)("div",{className:(0,n.cn)(s({variant:r}),t),...a})}},9799:(e,t,r)=>{r.d(t,{F:()=>a});var o=r(425);let a={async getSiteNotes(e){try{return(await o.A.get("/site-notes/apartment/".concat(e))).data}catch(e){throw console.error("Error fetching site notes:",e),e}},getSiteNotesByStatus:async(e,t)=>(await o.A.get("/site-notes/apartment/".concat(e,"/status/").concat(t))).data,async createSiteNote(e,t){try{return(await o.A.post("/site-notes/apartment/".concat(e),t,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(e){throw console.error("Error creating site note:",e),e}},async updateSiteNote(e,t){try{return(await o.A.put("/site-notes/".concat(e),t)).data}catch(e){throw console.error("Error updating site note:",e),e}},async deleteSiteNote(e){try{await o.A.delete("/site-notes/".concat(e))}catch(e){throw console.error("Error deleting site note:",e),e}},async getSiteNote(e){try{return(await o.A.get("/site-notes/".concat(e))).data}catch(e){throw console.error("Error fetching site note:",e),e}}}}}]);